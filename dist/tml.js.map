{"version":3,"file":"tml.js","sources":["../src/loader.ts","../src/tml.ts"],"sourcesContent":["// @ts-ignore\r\nexport const go = new global.Go();\r\n\r\nif (!WebAssembly.instantiateStreaming) {\r\n  WebAssembly.instantiateStreaming = async (resp, importObject) => {\r\n    const source = await(await resp).arrayBuffer();\r\n    return await WebAssembly.instantiate(source, importObject);\r\n  };\r\n}\r\n\r\nexport const load: (path: string) => Promise<void> = async (path) => {\r\n  try {\r\n    const {instance} = await WebAssembly.instantiateStreaming(fetch(path), go.importObject);\r\n\r\n    await go.run(instance);\r\n  } catch (e) {\r\n    throw e;\r\n  }\r\n};","import {load} from \"./loader\";\r\nimport {ParserConfig, Workout} from \"./types\";\r\n\r\nconst notReadyYet = new Error(\"WASM module is not ready yet\");\r\n\r\nexport let onReady: () => void = () => {};\r\nif (!(\"TML_parse\" in global))  {\r\n  load(\"https://cdn.jsdelivr.net/gh/yanishoss/tml/bin/main.wasm\")\r\n    .then(() => onReady())\r\n    .catch(e => {throw e});\r\n}\r\n\r\nexport function parse(input: string, conf?: ParserConfig): Workout {\r\n  if (!(\"TML_parse\" in global))  {\r\n    throw notReadyYet;\r\n  }\r\n\r\n  // @ts-ignore\r\n  const ret = TML_parse(input, conf);\r\n\r\n  if (ret.Error !== undefined) {\r\n    throw new Error(ret.Error());\r\n  }\r\n\r\n  return ret;\r\n}\r\n\r\nexport function withDefaultConfig(): ParserConfig {\r\n  if (!(\"TML_withDefaultConfig\" in global))  {\r\n    throw notReadyYet;\r\n  }\r\n\r\n  // @ts-ignore\r\n  return TML_withDefaultConfig(input, conf);\r\n}"],"names":["go","global","Go","WebAssembly","instantiateStreaming","resp","importObject","_resp","arrayBuffer","source","instantiate","notReadyYet","Error","path","fetch","run","instance","e","load","then","input","conf","ret","TML_parse","undefined","TML_withDefaultConfig"],"mappings":"IACaA,EAAK,IAAIC,OAAOC,GAExBC,YAAYC,uBACfD,YAAYC,8BAA8BC,EAAMC,8BACnBD,2CAAPE,EAAaC,6BAA3BC,0BACON,YAAYO,YAAYD,EAAQH,QAF/C,yCCDIK,EAAc,IAAIC,MAAM,gCAGxB,cAAeX,iBDIuCY,sEAE/BV,YAAYC,qBAAqBU,MCLvD,2DDKoEd,EAAGM,uDAEpEN,EAAGe,MAFFC,qGAGAC,GACP,MAAMA,KANO,mCCHfC,GACGC,KAAK,oBACC,SAAAF,GAAM,MAAMA,oBAJU,2BAOjC,SAAsBG,EAAeC,GACnC,KAAM,cAAepB,QACnB,MAAMU,EAIR,IAAMW,EAAMC,UAAUH,EAAOC,GAE7B,QAAkBG,IAAdF,EAAIV,MACN,UAAUA,MAAMU,EAAIV,SAGtB,OAAOU,wCAIP,KAAM,0BAA2BrB,QAC/B,MAAMU,EAIR,OAAOc,sBAAsBL,MAAOC"}